/**
 * Lists image files in Maavoimat and Merivoimat under public/assets/sotilasarvot
 * and writes src/data/ranksImagePaths.ts. Run from project root:
 *   node scripts/list-ranks-images.cjs
 *
 * Folder structure:
 *   public/assets/sotilasarvot/Maavoimat/   → Army ranks
 *   public/assets/sotilasarvot/Merivoimat/  → Navy ranks
 * Filename (without extension) = Finnish rank name. Must have matching entry in src/data/ranksData.ts (fi + ru).
 */
const fs = require('fs')
const path = require('path')

const BASE = path.join(__dirname, '..', 'public', 'assets', 'sotilasarvot')
const OUT_FILE = path.join(__dirname, '..', 'src', 'data', 'ranksImagePaths.ts')
const EXTENSIONS = new Set(['.jpg', '.jpeg', '.png', '.webp'])

const FOLDER_MAAVOIMAT = 'Maavoimat'
const FOLDER_MERIVOIMAT = 'Merivoimat'

function walkDir(dir, pathPrefix, acc) {
  if (!fs.existsSync(dir)) return
  const entries = fs.readdirSync(dir, { withFileTypes: true })
  for (const e of entries) {
    const full = path.join(dir, e.name)
    const rel = pathPrefix ? `${pathPrefix}/${e.name}` : e.name
    if (e.isDirectory()) {
      walkDir(full, rel, acc)
    } else if (EXTENSIONS.has(path.extname(e.name).toLowerCase())) {
      acc.push('/assets/sotilasarvot/' + rel.replace(/\\/g, '/'))
    }
  }
}

const maavoimatPaths = []
const merivoimatPaths = []

walkDir(path.join(BASE, FOLDER_MAAVOIMAT), FOLDER_MAAVOIMAT, maavoimatPaths)
walkDir(path.join(BASE, FOLDER_MERIVOIMAT), FOLDER_MERIVOIMAT, merivoimatPaths)

maavoimatPaths.sort()
merivoimatPaths.sort()

const content = `/**
 * Sotilasarvot image paths by branch.
 * Generated by: node scripts/list-ranks-images.cjs (run from project root)
 * Folders: public/assets/sotilasarvot/Maavoimat/ and .../Merivoimat/
 * Filename (without extension) = Finnish rank name. Re-run after adding/renaming images.
 */
export const RANKS_MAAVOIMAT_PATHS: string[] = ${JSON.stringify(maavoimatPaths, null, 2)}

export const RANKS_MERIVOIMAT_PATHS: string[] = ${JSON.stringify(merivoimatPaths, null, 2)}
`

fs.writeFileSync(OUT_FILE, content, 'utf8')
console.log('Wrote', maavoimatPaths.length, 'Maavoimat paths and', merivoimatPaths.length, 'Merivoimat paths to', OUT_FILE)
